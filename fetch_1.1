<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/reset.css">
  <title>Library</title>
</head>



<style>
  button{
    border-radius: 4px;
    padding: .8rem 1.4rem;
    background :#1f98e8;
    color:#fff;
    font-size: 1rem;
  }
  
  body{
    margin: 0 2rem;
  }
  
  .data-wrap{
    display: grid;
    grid-template-columns: 1fr;
    border-top: 1px solid #ccc;
    padding:1rem 3rem;
    margin-bottom: 1rem;
    margin-top :1.2rem;
    background : #eee;
    }
  
  
  .book-wrap{
    display: grid;
    grid-template-columns: 1fr 4fr;
    gap :3rem;
    border-top: 1px solid #eaeaea;
    padding:2rem;
    background: #fff;
    position: relative;
    
  
  }
  
  .data-wrap:nth-last-of-type(1){
    border-bottom: 1px solid #eaeaea;
  }
  
  
  .book-wrap .detail{
    color: #999;
  }
  
  .book-wrap .detail span{
    color: #000;
    font-weight: 500;
  }
  
  .book-wrap .detail span:nth-of-type(1){
    color: #000;
    font-weight: normal;
  }
  
  .book-wrap  .name{
    margin-bottom:1rem;
  }
  
  .book-wrap img{
    object-fit: contain;
    width:200px;
    height:294px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.12);
    border-radius: 6px;
  }
  

  .top-btn{
    position: fixed;
    bottom: 3rem;
    right:3rem;

  }

  .top-btn .top-scroll-btn{
    display: flex;
    justify-content: center;
    align-items: center;
    height:100%;
    border-radius: 50%;
    padding:1rem;
    cursor: pointer;
    
  }

  .the-book-detail{
    position: absolute;
    right: 1rem;
    top:50%;
    width:3rem;
    height:3rem;
    background: #ccc;
    border-radius: 50%;
    transform: translateY(-50%);
    cursor: pointer;
  }
  
  .the-book-detail:after{
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    display: block;
    width: 1rem;
    height: 1rem;
    border-width: 0;
    border-style: solid;
    border-color: #fff;
    border-top-width: 2px;
    border-right-width: 2px;
    -webkit-transform: translate(-75%, -50%) rotate(45deg);
    transform: translate(-75%, -50%) rotate(45deg);
    z-index: 1;
  }


  </style>
  <body>
    
    <h1>지역 도서관 대출 베스트 </h1>
    <button id="action" type="button">CLICK(세종시)</button>

    <table class="columns">
      <tr>
        <td><div id="Sarah_chart_div" style="border: 1px solid #ccc"></div></td>
        <td><div id="Anthony_chart_div" style="border: 1px solid #ccc"></div></td>
      </tr>
    </table>

        <h2>${선택한 도서관 }주제별 세부자료</h2>
        <div class="chart-area"></div>
      </div>
    </div>
    
    <div class="data-wrap"></div>


    <div class="top-btn">
      <button class="top-scroll-btn" type="button" onclick="scrollTop">TOP</button>

    </div>
      
  <!-- 
  
    <div class="container">
      <h3>Ideas List</h3>
      <ol>
        <li><a href="#=">특정 기간 동안의 대출 총량을 분석하여 상위 몇개만 추릴 것</a>
          <p> failure bc 너무 많은 양의 데이터 호출 불가</p>
          <img class="" src="https://blog.kakaocdn.net/dn/ccn0bP/btsDbemancN/UC64b3ZGr3FhbFmtNBcG51/img.png" alt="">
          <li>
            <a href="#=" >지역별 인기도서 선정(3번, 7 페이지)</a>
            <dl>
              <dt></dt>
              <dd></dd>
            </dl>
          </li>
          <li>
            <a href="#=" >지역별 독서량/독서율 (18번 API)</a>
            <dl>
              <dt>재미있는 요소</dt>
              <dd>독서량(quantity): 대출 회원 1 명이 읽은 일반도서의 권수(대출 권수/대출 회원수)</dd>
              <dd>독서율(rate): 일반도서를 1 권 이상 읽은 사람의 비율(대출 회원수/전체 회원수)</dd>
            </dl>
          
          </li>
          <li><a href="#=" ></a></li>
      </ol>
  
    </div>
  
  <br>
  <div class="container">
    <h3>각 인증을 위한 파라미터 코드(19번 )</h3>
    <div class="grid">
      <div class="code-grid-item">
        <h4>지역 코드(region)</h4>
        <p>1. 서울(11)</p>
        <p>2. 세종특별자치시 (29)</p>
        <p>3. 경기도 (31)</p>
      </div>
      <div class="code-grid-item">
        <h4>세부지역 구분(dtl_region)</h4>
        <p>1. 경기도 성남시 분당구(31023)</p>
        <p>2. 세종특별자치시 (29010)</p>
        <p>3. 서울특별시 송파구 (11240)</p>
        <p>4. 서울특별시 강동구 (11250)</p>
      </div>
      <div class="code-grid-item">
        <h4>도서관/지역별 인기대출 도서 조회(9번, 페이지25)</h4>
        <p></p>
      </div>
      <div class="code-grid-item"></div>
  
    </div>
  </div>
  
  <style>
    img{
      width:800px;
      height: 100%;
      box-shadow: 4px 4px 4px 4px rgba(0, 0, 0, 0.194);
    }
  
    .grid{
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: 1fr;
      background: bisque;
      padding:10px;
    }
  
  </style> -->
  
  
    <script>
      const $bookApiBtn = document.querySelector("#action");
      const $bookWrap = document.querySelector(".data-wrap");
  
      const scrollTop = () => {
        console.log('click');
        document.querySelector(".top-btn").scrollTop = 0;
      }


      $bookApiBtn.addEventListener("click", ()=>{
        libBooks();
  
      })
  
  
      function libBooks() {
        const url = "http://data4library.kr/api/loanItemSrchByLib?authKey=43d7efdc5d7f99a3be907ecac62d3212026fb810e793f19e56fb0b5a390c93f8&dtl_region=11240&startDt=2023-01-01&endDt=2023-12-31&format=json"
  
        fetch(url).then((response) => {
          if(response.status != 200){
            console.log("서버 통신 실패")
            return
          } else{
            return response.json();
          }
        }).then((data) =>{
          const jsonData = data.response.docs;
          let dataBox ="";
          let firstGenres = [];
          let secondGenres =[];
          let kdcEtc=0;
          let kdcPhilo=0;
          let kdcReli=0;
          let kdcSociety=0;
          let kdcNature=0;
          let kdcTech=0;
          let kdcArt=0;
          let kdcLang=0;
          let kdcLitera=0;
          let kdcHisto=0;

          let literaGeneral =0
          let literaKorea =0
          let literaChina =0
          let literaJapan =0
          let literaEnglish =0
          let literaGerman =0
          let literaFrance =0
          let literaSpain =0
          let literaItaly =0
          let literaEtc =0


          // console.dir(jsonData);

          for (let a = 0; a < jsonData.length; a++){
            let trim1 = jsonData[a].doc.class_nm.replace("> ", "");
            let trim2 = trim1.split(" ");
            firstGenres.push(trim2[0]);
            if(trim2[0] =="총류") {kdcEtc++}
            if(trim2[0] =="철학") {kdcPhilo++}
            if(trim2[0] =="종교") {kdcReli++}
            if(trim2[0] =="사회과학") {kdcSociety +=1 }
            if(trim2[0] =="자연과학") {kdcNature++}
            if(trim2[0] =="기술과학") {kdcTech++}
            if(trim2[0] =="예술") {kdcArt++}
            if(trim2[0] =="언어") {kdcLang++}
            if(trim2[0] =="문학") {kdcLitera++}
            if(trim2[0] =="역사") {kdcHisto++}

            if(trim2[0] && trim2[1]=="문학" ) {literaGeneral++}
            if(trim2[0] && trim2[1]=="한국문학" ) {literaKorea++}
            if(trim2[0] && trim2[1]=="중국문학" ) {literaChina++}
            if(trim2[0] && trim2[1]=="일본문학" ) {literaJapan++}
            if(trim2[0] && trim2[1]=="영미문학" ) {literaEnglish++}
            if(trim2[0] && trim2[1]=="독일문학" ) {literaGerman++}
            if(trim2[0] && trim2[1]=="프랑스문학" ) {literaFrance++}
            if(trim2[0] && trim2[1]=="스페인문학" ) {literaSpain++}
            if(trim2[0] && trim2[1]=="이탈리아문학" ) {literaItaly++}
            if(trim2[0] && trim2[1]=="기타제문학" ) {literaEtc++}
  
          }




        // Load Charts and the corechart package.
        google.charts.load('current', {'packages':['corechart']});

        // Draw the pie chart for Sarah's pizza when Charts is loaded.
        google.charts.setOnLoadCallback(drawSarahChart);

        // Draw the pie chart for the Anthony's pizza when Charts is loaded.
        google.charts.setOnLoadCallback(drawAnthonyChart);

        // Callback that draws the pie chart for Sarah's pizza.
        function drawSarahChart() {

          // Create the data table for Sarah's pizza.
          var data = new google.visualization.DataTable();
          data.addColumn('string', 'Topping');
          data.addColumn('number', 'Slices');
          data.addRows([
            ['총류', kdcEtc],
            ['철학', kdcPhilo],
            ['종교', kdcReli],
            ['사회과학', kdcSociety],
            ['자연과학', kdcNature]
          ]);

          // Set options for Sarah's pie chart.
          var options = {title:'${도서관} 주제별 ',
                        width:400,
                        height:300};

          // Instantiate and draw the chart for Sarah's pizza.
          var chart = new google.visualization.PieChart(document.getElementById('Sarah_chart_div'));
          chart.draw(data, options);
        }

        // Callback that draws the pie chart for Anthony's pizza.
        function drawAnthonyChart() {

          // Create the data table for Anthony's pizza.
          var data = new google.visualization.DataTable();
          data.addColumn('string', 'Topping');
          data.addColumn('number', 'Slices');
          data.addRows([
            ['Mushrooms', 1],
            ['Onions', 2],
            ['Olives', 2],
            ['Zucchini', 0],
            ['Pepperoni', 3]
          ]);

          // Set options for Anthony's pie chart.
          var options = {title:'How Much Pizza Anthony Ate Last Night',
                        width:400,
                        height:300};

          // Instantiate and draw the chart for Anthony's pizza.
          var chart = new google.visualization.PieChart(document.getElementById('Anthony_chart_div'));
          chart.draw(data, options);
        }







          jsonData.forEach((value, index) => {
          const bookImageURL = value.doc.bookImageURL || "https://www.splib.or.kr/include/image/common/noimg_book.png"
  
            dataBox += `
            <div class="book-wrap">
              <img class="book-img" src="${bookImageURL ? bookImageURL :"https://www.splib.or.kr/include/image/common/noimg_book.png" }" alt="${value.doc.bookname}">
              <div class="detail">
                <h2 class="name"><span>${index+1}.&nbsp${value.doc.bookname}</span></h2>
                <div class="author">작가 : <span>${value.doc.authors}</span></div>
                <div class="genres">장르: <span>${value.doc.class_nm}</span></div>
                <div class="isbn13">ISBN : <span>${value.doc.isbn13}</span></div>
                <div class="ranking">대출 순위 : <span> ${value.doc.ranking}</span></div>
              </div>
              <div class="the-book-detail"></div>
            </div>
              `  });
            document.querySelector(".data-wrap").innerHTML = dataBox;
  
          }).catch(error =>{
          console.log("에러 발생")
        })
      } 
  
  
    </script>


  </body>
  </html>
